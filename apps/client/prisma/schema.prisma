generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["multiSchema"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["public", "dabao_tenant"]
}


model Project {
  id             String   @id @default(cuid())
  name           String
  description    String?
  slug           String   @unique
  status         String?
  projectType    String   @default("REWARDS") @map("project_type") // "REWARDS" or "LOYALTY"
  organizationId String   @map("organization_id")
  active         Boolean  @default(true)
  customDomain   String?  @unique @map("custom_domain")
  settings       Json? // Free-form tenant config
  theme          Json? // e.g. Tailwind theme overrides
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  // Domain management relations
  domains                 ProjectDomain[]

  @@map("projects")
  @@schema("dabao_tenant")
}

// Domain Type enum for distinguishing between domain types
enum DomainType {
  PRIMARY
  SUBDOMAIN
  CUSTOM_DOMAIN
  ALIAS

  @@schema("dabao_tenant")
}

// ProjectDomain model for managing domains and subdomains
model ProjectDomain {
  id                String     @id @default(cuid())
  projectId         String     @map("project_id")
  domain            String     @unique
  type              DomainType @default(SUBDOMAIN)
  isPrimary         Boolean    @default(false) @map("is_primary")
  isVerified        Boolean    @default(false) @map("is_verified")
  verificationToken String?    @map("verification_token")
  verifiedAt        DateTime?  @map("verified_at")
  dnsSettings       Json?      @map("dns_settings") // DNS settings like CNAME, A records
  sslEnabled        Boolean    @default(false) @map("ssl_enabled") 
  sslCertificate    String?    @map("ssl_certificate")
  sslExpiresAt      DateTime?  @map("ssl_expires_at")
  createdAt         DateTime   @default(now()) @map("created_at")
  updatedAt         DateTime   @updatedAt @map("updated_at")

  // Relations
  project  Project       @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, domain])
  @@map("project_domains")
  @@schema("dabao_tenant")
}